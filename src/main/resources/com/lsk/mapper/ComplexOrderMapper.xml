<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lsk.dao.ComplexOrderMapper">
    <resultMap id="BaseResultMap" type="com.lsk.entity.ComplexOrder">
        <id column="oid" jdbcType="BIGINT" property="oid" />
        <result column="payamount" jdbcType="DECIMAL" property="payamount" />
        <result column="dealtime" jdbcType="TIMESTAMP" property="dealtime" />
        <result column="state" jdbcType="TINYINT" property="state" />
        <result column="uid" jdbcType="INTEGER" property="uid"/>
        <association property="payer" javaType="com.lsk.entity.User">
            <id column="uid" jdbcType="INTEGER" property="uid" />
            <result column="openid" jdbcType="VARCHAR" property="openid" />
            <result column="nickname" jdbcType="VARCHAR" property="nickname" />
            <result column="img" jdbcType="VARCHAR" property="img" />
            <result column="contact" jdbcType="VARCHAR" property="contact" />
        </association>
        <association property="goods" javaType="com.lsk.entity.Goods">
            <id column="gid" jdbcType="INTEGER" property="gid" />
            <result column="goodsname" jdbcType="VARCHAR" property="goodsname" />
            <result column="goodsimg" jdbcType="VARCHAR" property="goodsimg" />
            <result column="goodsprice" jdbcType="DECIMAL" property="goodsprice" />
            <result column="goodsdesc" jdbcType="VARCHAR" property="goodsdesc" />
            <result column="category" jdbcType="TINYINT" property="category" />
            <result column="pid" jdbcType="INTEGER" property="pid" />
            <result column="state" jdbcType="TINYINT" property="state" />
            <result column="quality" jdbcType="VARCHAR" property="quality" />
            <result column="issuedate" jdbcType="TIMESTAMP" property="issuedate" />
            <result column="duedate" jdbcType="TIMESTAMP" property="duedate" />
            <result column="originalprice" jdbcType="DECIMAL" property="originalprice" />
        </association>
    </resultMap>

    <sql id="Base_Column_List">
        order.oid, order.gid, order.payer, order.payamount, order.dealtime, order.state,
        goods.gid, goods.goodsname, goods.goodsimg, goods.goodsprice, goods.goodsdesc, goods.category, goods.pid, goods.state, goods.quality, goods.issuedate,goods.duedate, goods.originalprice,
        user.openid, user.nickname, user.img, user.contact
   </sql>
    <select id="selectOrderByUid" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        select
        <include refid="Base_Column_List"></include>
        from `order`
		left join `user`
			on `user`.uid = `order`.payer
		left join goods
			on goods.gid = `order`.gid
        where goods.pid=#{uid} and `order`.state=0 or `order`.state=1
    </select>
    <select id="selectOrderByPayer" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        select
        <include refid="Base_Column_List"></include>
        from `order`
        left join `user`
        on `user`.uid = `order`.payer
        left join goods
        on goods.gid = `order`.gid
        where `order`.payer=#{userid}
    </select>
</mapper>